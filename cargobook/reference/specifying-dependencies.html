<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>指定依赖 - The Cargo Book</title>


        <!-- Custom HTML head -->
        <style>
            dd {
                margin-bottom: 1em;
            }
        </style>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">简介</a></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">1.</strong> 初步准备</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/installation.html"><strong aria-hidden="true">1.1.</strong> 安装</a></li><li class="chapter-item expanded "><a href="../getting-started/first-steps.html"><strong aria-hidden="true">1.2.</strong> Cargo起步</a></li></ol></li><li class="chapter-item expanded "><a href="../guide/index.html"><strong aria-hidden="true">2.</strong> Cargo指南</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../guide/why-cargo-exists.html"><strong aria-hidden="true">2.1.</strong> 为何有Cargo</a></li><li class="chapter-item expanded "><a href="../guide/creating-a-new-project.html"><strong aria-hidden="true">2.2.</strong> 创建新包</a></li><li class="chapter-item expanded "><a href="../guide/working-on-an-existing-project.html"><strong aria-hidden="true">2.3.</strong> 拥有Cargo包</a></li><li class="chapter-item expanded "><a href="../guide/dependencies.html"><strong aria-hidden="true">2.4.</strong> 依赖</a></li><li class="chapter-item expanded "><a href="../guide/project-layout.html"><strong aria-hidden="true">2.5.</strong> 包的布局</a></li><li class="chapter-item expanded "><a href="../guide/cargo-toml-vs-cargo-lock.html"><strong aria-hidden="true">2.6.</strong> Cargo.toml vs Cargo.lock</a></li><li class="chapter-item expanded "><a href="../guide/tests.html"><strong aria-hidden="true">2.7.</strong> 测试</a></li><li class="chapter-item expanded "><a href="../guide/continuous-integration.html"><strong aria-hidden="true">2.8.</strong> 持续集成</a></li><li class="chapter-item expanded "><a href="../guide/cargo-home.html"><strong aria-hidden="true">2.9.</strong> Cargo Home</a></li><li class="chapter-item expanded "><a href="../guide/build-cache.html"><strong aria-hidden="true">2.10.</strong> 构建缓存</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/index.html"><strong aria-hidden="true">3.</strong> Cargo参考</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/specifying-dependencies.html" class="active"><strong aria-hidden="true">3.1.</strong> 指定依赖</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/overriding-dependencies.html"><strong aria-hidden="true">3.1.1.</strong> 覆盖依赖</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/manifest.html"><strong aria-hidden="true">3.2.</strong> 配置格式</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/cargo-targets.html"><strong aria-hidden="true">3.2.1.</strong> Cargo目标</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/workspaces.html"><strong aria-hidden="true">3.3.</strong> 工作空间</a></li><li class="chapter-item expanded "><a href="../reference/features.html"><strong aria-hidden="true">3.4.</strong> 特性</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/features-examples.html"><strong aria-hidden="true">3.4.1.</strong> 特性示例</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/profiles.html"><strong aria-hidden="true">3.5.</strong> 编译设置</a></li><li class="chapter-item expanded "><a href="../reference/config.html"><strong aria-hidden="true">3.6.</strong> 配置</a></li><li class="chapter-item expanded "><a href="../reference/environment-variables.html"><strong aria-hidden="true">3.7.</strong> 环境变量</a></li><li class="chapter-item expanded "><a href="../reference/build-scripts.html"><strong aria-hidden="true">3.8.</strong> 构建脚本</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/build-script-examples.html"><strong aria-hidden="true">3.8.1.</strong> 构建脚本示例</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/publishing.html"><strong aria-hidden="true">3.9.</strong> 发布到crates.io</a></li><li class="chapter-item expanded "><a href="../reference/pkgid-spec.html"><strong aria-hidden="true">3.10.</strong> 包ID规格</a></li><li class="chapter-item expanded "><a href="../reference/source-replacement.html"><strong aria-hidden="true">3.11.</strong> 源替代</a></li><li class="chapter-item expanded "><a href="../reference/external-tools.html"><strong aria-hidden="true">3.12.</strong> 插件</a></li><li class="chapter-item expanded "><a href="../reference/registries.html"><strong aria-hidden="true">3.13.</strong> 注册中心</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/running-a-registry.html"><strong aria-hidden="true">3.13.1.</strong> 运行注册中心</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/registry-index.html"><strong aria-hidden="true">3.13.1.1.</strong> 注册中心索引</a></li><li class="chapter-item expanded "><a href="../reference/registry-web-api.html"><strong aria-hidden="true">3.13.1.2.</strong> 注册中心Web API</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../reference/resolver.html"><strong aria-hidden="true">3.14.</strong> 依赖解析</a></li><li class="chapter-item expanded "><a href="../reference/semver.html"><strong aria-hidden="true">3.15.</strong> 语义化兼容</a></li><li class="chapter-item expanded "><a href="../reference/future-incompat-report.html"><strong aria-hidden="true">3.16.</strong> 未来不兼容报告</a></li><li class="chapter-item expanded "><a href="../reference/timings.html"><strong aria-hidden="true">3.17.</strong> 构建时报告</a></li><li class="chapter-item expanded "><a href="../reference/unstable.html"><strong aria-hidden="true">3.18.</strong> 不稳定特性</a></li></ol></li><li class="chapter-item expanded "><a href="../commands/index.html"><strong aria-hidden="true">4.</strong> Cargo命令</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/general-commands.html"><strong aria-hidden="true">4.1.</strong> 常用命令</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/cargo.html"><strong aria-hidden="true">4.1.1.</strong> cargo</a></li><li class="chapter-item expanded "><a href="../commands/cargo-help.html"><strong aria-hidden="true">4.1.2.</strong> cargo help</a></li><li class="chapter-item expanded "><a href="../commands/cargo-version.html"><strong aria-hidden="true">4.1.3.</strong> cargo version</a></li></ol></li><li class="chapter-item expanded "><a href="../commands/build-commands.html"><strong aria-hidden="true">4.2.</strong> 构建命令</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/cargo-bench.html"><strong aria-hidden="true">4.2.1.</strong> cargo bench</a></li><li class="chapter-item expanded "><a href="../commands/cargo-build.html"><strong aria-hidden="true">4.2.2.</strong> cargo build</a></li><li class="chapter-item expanded "><a href="../commands/cargo-check.html"><strong aria-hidden="true">4.2.3.</strong> cargo check</a></li><li class="chapter-item expanded "><a href="../commands/cargo-clean.html"><strong aria-hidden="true">4.2.4.</strong> cargo clean</a></li><li class="chapter-item expanded "><a href="../commands/cargo-doc.html"><strong aria-hidden="true">4.2.5.</strong> cargo doc</a></li><li class="chapter-item expanded "><a href="../commands/cargo-fetch.html"><strong aria-hidden="true">4.2.6.</strong> cargo fetch</a></li><li class="chapter-item expanded "><a href="../commands/cargo-fix.html"><strong aria-hidden="true">4.2.7.</strong> cargo fix</a></li><li class="chapter-item expanded "><a href="../commands/cargo-run.html"><strong aria-hidden="true">4.2.8.</strong> cargo run</a></li><li class="chapter-item expanded "><a href="../commands/cargo-rustc.html"><strong aria-hidden="true">4.2.9.</strong> cargo rustc</a></li><li class="chapter-item expanded "><a href="../commands/cargo-rustdoc.html"><strong aria-hidden="true">4.2.10.</strong> cargo rustdoc</a></li><li class="chapter-item expanded "><a href="../commands/cargo-test.html"><strong aria-hidden="true">4.2.11.</strong> cargo test</a></li><li class="chapter-item expanded "><a href="../commands/cargo-report.html"><strong aria-hidden="true">4.2.12.</strong> cargo report</a></li></ol></li><li class="chapter-item expanded "><a href="../commands/manifest-commands.html"><strong aria-hidden="true">4.3.</strong> 配置命令</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/cargo-add.html"><strong aria-hidden="true">4.3.1.</strong> cargo add</a></li><li class="chapter-item expanded "><a href="../commands/cargo-generate-lockfile.html"><strong aria-hidden="true">4.3.2.</strong> cargo generate-lockfile</a></li><li class="chapter-item expanded "><a href="../commands/cargo-locate-project.html"><strong aria-hidden="true">4.3.3.</strong> cargo locate-project</a></li><li class="chapter-item expanded "><a href="../commands/cargo-metadata.html"><strong aria-hidden="true">4.3.4.</strong> cargo metadata</a></li><li class="chapter-item expanded "><a href="../commands/cargo-pkgid.html"><strong aria-hidden="true">4.3.5.</strong> cargo pkgid</a></li><li class="chapter-item expanded "><a href="../commands/cargo-remove.html"><strong aria-hidden="true">4.3.6.</strong> cargo remove</a></li><li class="chapter-item expanded "><a href="../commands/cargo-tree.html"><strong aria-hidden="true">4.3.7.</strong> cargo tree</a></li><li class="chapter-item expanded "><a href="../commands/cargo-update.html"><strong aria-hidden="true">4.3.8.</strong> cargo update</a></li><li class="chapter-item expanded "><a href="../commands/cargo-vendor.html"><strong aria-hidden="true">4.3.9.</strong> cargo vendor</a></li><li class="chapter-item expanded "><a href="../commands/cargo-verify-project.html"><strong aria-hidden="true">4.3.10.</strong> cargo verify-project</a></li></ol></li><li class="chapter-item expanded "><a href="../commands/package-commands.html"><strong aria-hidden="true">4.4.</strong> 包命令</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/cargo-init.html"><strong aria-hidden="true">4.4.1.</strong> cargo init</a></li><li class="chapter-item expanded "><a href="../commands/cargo-install.html"><strong aria-hidden="true">4.4.2.</strong> cargo install</a></li><li class="chapter-item expanded "><a href="../commands/cargo-new.html"><strong aria-hidden="true">4.4.3.</strong> cargo new</a></li><li class="chapter-item expanded "><a href="../commands/cargo-search.html"><strong aria-hidden="true">4.4.4.</strong> cargo search</a></li><li class="chapter-item expanded "><a href="../commands/cargo-uninstall.html"><strong aria-hidden="true">4.4.5.</strong> cargo uninstall</a></li></ol></li><li class="chapter-item expanded "><a href="../commands/publishing-commands.html"><strong aria-hidden="true">4.5.</strong> 发布命令</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/cargo-login.html"><strong aria-hidden="true">4.5.1.</strong> cargo login</a></li><li class="chapter-item expanded "><a href="../commands/cargo-owner.html"><strong aria-hidden="true">4.5.2.</strong> cargo owner</a></li><li class="chapter-item expanded "><a href="../commands/cargo-package.html"><strong aria-hidden="true">4.5.3.</strong> cargo package</a></li><li class="chapter-item expanded "><a href="../commands/cargo-publish.html"><strong aria-hidden="true">4.5.4.</strong> cargo publish</a></li><li class="chapter-item expanded "><a href="../commands/cargo-yank.html"><strong aria-hidden="true">4.5.5.</strong> cargo yank</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../faq.html"><strong aria-hidden="true">5.</strong> 常见问题</a></li><li class="chapter-item expanded "><a href="../supplement.html"><strong aria-hidden="true">6.</strong> 译者补充</a></li><li class="chapter-item expanded "><a href="../appendix/glossary.html"><strong aria-hidden="true">7.</strong> 附录: 词汇表</a></li><li class="chapter-item expanded "><a href="../appendix/git-authentication.html"><strong aria-hidden="true">8.</strong> 附录: Git认证</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Cargo Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/cargo/tree/master/src/doc/src" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/cargo/edit/master/src/doc/src/reference/specifying-dependencies.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="指定依赖"><a class="header" href="#指定依赖">指定依赖</a></h2>
<p>你的crate能够依赖于其他库，其库可以来自 <a href="https://crates.io/">crates.io</a> 、其他注册中心、git仓库、本地文件系统中的子目录。
你可以暂时覆盖某个依赖的路径，从而在本地检查和修复依赖的bug。
对于不同目标平台可以指定不同的依赖，也可以仅在开发阶段指定使用某个依赖。</p>
<h3 id="指定crateio中的依赖"><a class="header" href="#指定crateio中的依赖">指定crate.io中的依赖</a></h3>
<p>Cargo默认从 <a href="https://crates.io/">crates.io</a> 查找依赖。之前在 <a href="../guide/index.html">cargo指南</a> 中指定了 <code>time</code> crate 作为依赖: </p>
<pre><code class="language-toml">[dependencies]
time = &quot;0.1.12&quot;
</code></pre>
<p><code>&quot;0.1.12&quot;</code> 这个字符串表示限定的版本，虽然貌似表示一个具体的 <code>time</code> 版本，但实际上表示一个范围，接受 <a href="https://semver.org">SemVer</a> 语义化兼容的更新。
具体来说，接受不改变 <code>主版本号.次版本号.修订号</code> 中 <strong>第一个非零数字</strong> 的所有更新。
如果运行 <code>cargo update -p time</code> ，Cargo 会把 <code>time</code> 更新到 <code>0.1.13</code> (假设 <code>0.1.z</code> 表示的最新版本)，但不会更新到 <code>0.2.0</code>。
如果指定版本为 <code>1.0</code> ，那么Cargo 会将其更新到 <code>1.1</code> (假设 <code>1.y</code> 表示的最新版本)，但不会更新到 <code>2.0</code> 。 <code>0.0.x</code> 版本和其他版本都不兼容。</p>
<p>下面是一些书写示例，以及符合要求的版本范围:</p>
<pre><code class="language-notrust">1.2.3  :=  &gt;=1.2.3, &lt;2.0.0
1.2    :=  &gt;=1.2.0, &lt;2.0.0
1      :=  &gt;=1.0.0, &lt;2.0.0
0.2.3  :=  &gt;=0.2.3, &lt;0.3.0
0.2    :=  &gt;=0.2.0, &lt;0.3.0
0.0.3  :=  &gt;=0.0.3, &lt;0.0.4
0.0    :=  &gt;=0.0.0, &lt;0.1.0
0      :=  &gt;=0.0.0, &lt;1.0.0
</code></pre>
<p>这种兼容规则与SemVer规则有所不同，SemVer认为在1.0.0之前都不兼容，而Cargo认为 <code>0.x.y</code> 与 <code>0.x.z</code>兼容 (只要 <code>y ≥ z</code> 且 <code>x &gt; 0</code>)。</p>
<p>可以通过一些特殊操作符来调整选择兼容版本的逻辑，但在大多数情况不需要。</p>
<h3 id="使用--符号"><a class="header" href="#使用--符号">使用 <code>^</code> 符号</a></h3>
<p><code>^</code> 符号表示默认策略，<code>^1.2.3</code> 和 <code>1.2.3</code> 的意义相同。</p>
<h3 id="使用--符号-1"><a class="header" href="#使用--符号-1">使用 <code>~</code> 符号</a></h3>
<p><code>~</code> 符号表示在某个最小版本的基础上可以做指定更新。
如果指定了如 <code>主.次.修</code> 或者 <code>主.次</code> 的版本，那么可以做修订级别的改变。
如果是只指定了主版本号，那么次版本号和修订号可以改变。</p>
<p><code>~1.2.3</code> 的例子:</p>
<pre><code class="language-notrust">~1.2.3  := &gt;=1.2.3, &lt;1.3.0
~1.2    := &gt;=1.2.0, &lt;1.3.0
~1      := &gt;=1.0.0, &lt;2.0.0
</code></pre>
<h3 id="使用--通配符"><a class="header" href="#使用--通配符">使用 <code>*</code> 通配符</a></h3>
<p>通配符出现的位置表示任意数字。</p>
<p>比如 <code>*</code> 、 <code>1.*</code> 、 <code>1.2.*</code>。</p>
<pre><code class="language-notrust">*     := &gt;=0.0.0
1.*   := &gt;=1.0.0, &lt;2.0.0
1.2.* := &gt;=1.2.0, &lt;1.3.0
</code></pre>
<blockquote>
<p><strong>注意</strong>: <a href="https://crates.io/">crates.io</a> 不允许单独的 <code>*</code> 。</p>
</blockquote>
<h3 id="使用比较符号"><a class="header" href="#使用比较符号">使用比较符号</a></h3>
<p>使用比较符号可以手动指定版本范围或一个具体的版本。</p>
<p>下面是一些例子:</p>
<pre><code class="language-notrust">&gt;= 1.2.0
&gt; 1
&lt; 2
= 1.2.3
</code></pre>
<h3 id="多重约束"><a class="header" href="#多重约束">多重约束</a></h3>
<p>参考上面的示例，多个版本约束可以用逗号分隔，如 <code>&gt;= 1.2, &lt; 1.5</code>。</p>
<h3 id="指定来自其他注册中心的依赖"><a class="header" href="#指定来自其他注册中心的依赖">指定来自其他注册中心的依赖</a></h3>
<p>要指定非 <a href="https://crates.io/">crates.io</a> 的依赖，首先须在 <code>.cargo/config.toml</code> 中设置该注册中心，参见 <a href="registries.html">registries documentation</a> 。
在依赖中，将 <code>registry</code> 字段设置为要使用的注册中心。</p>
<pre><code class="language-toml">[dependencies]
some-crate = { version = &quot;1.0&quot;, registry = &quot;my-registry&quot; }
</code></pre>
<blockquote>
<p><strong>注意</strong>: <a href="https://crates.io/">crates.io</a> 发布包不允许带有其他注册中心的依赖。</p>
</blockquote>
<h3 id="指定来自-git-的依赖"><a class="header" href="#指定来自-git-的依赖">指定来自 <code>git</code> 的依赖</a></h3>
<p>要指定位于 <code>git</code> 仓库的依赖，需要的最少信息是在 <code>git</code> 字段中给出该仓库的地址:</p>
<pre><code class="language-toml">[dependencies]
regex = { git = &quot;https://github.com/rust-lang/regex.git&quot; }
</code></pre>
<p>Cargo 会 fetch 该 <code>git</code> 仓库，并在仓库中查找所需crate对应的 <code>Cargo.toml</code> 文件(该文件不要求必须在地址根目录下，比如说指定的是工作空间某个成员crate，这时 <code>git</code> 字段只需给出工作空间的地址)。</p>
<p>因为没有指定其他信息，Cargo会假设使用该仓库主分支的最新提交。
也可以在 <code>git</code> 字段后加上 <code>rev</code> 、 <code>tag</code> 或 <code>branch</code> 字段，来指定想要的提交。下面是一个指定 <code>next</code> 分支上最新提交的例子:</p>
<pre><code class="language-toml">[dependencies]
regex = { git = &quot;https://github.com/rust-lang/regex.git&quot;, branch = &quot;next&quot; }
</code></pre>
<p>如果想要指定的依赖版本不是某个分支或标签，那么用 <code>rev</code> 来指定。
<code>rev</code> 字段可以是 <code>rev = &quot;4c59b707&quot;</code> 这样的提交hash，也可以是 <code>rev = &quot;refs/pull/493/head&quot;</code> 这样的名称。
哪些引用是合法的取决于这个git仓库具体的管理组织。
Github 公开每个 pull requeset 最新提交的引用，其他git组织一般也提供类似的信息，只是可能有不同的命名规则。</p>
<p>一旦添加某个 <code>git</code> 依赖，Cargo会立即锁定到该依赖最新的提交。
之后即使有新的提交，Cargo也不会自动拉取。可以通过 <code>cargo update</code> 命令来手动拉取。</p>
<p>对于私有仓库的身份验证，参考 <a href="../appendix/git-authentication.html">Git 身份验证</a>。</p>
<blockquote>
<p><strong>注意</strong>: <a href="https://crates.io/">crates.io</a> 发布的包不允许带有 <code>git</code> 依赖 (<code>git</code> <a href="#development-dependencies">dev-dependencies</a> 除外) 。关于备用方案，参考 <a href="#multiple-locations">Multiple locations</a>。</p>
</blockquote>
<h3 id="指定路径依赖"><a class="header" href="#指定路径依赖">指定路径依赖</a></h3>
<p>经过一段时间，<a href="../guide/index.html">指南</a> 中的 <code>hello_world</code> 包内容增多了。可能需要把其中一部分拆出来。
Cargo 为此提供了指定路径依赖的功能，常见的情况是一个 git 仓库中有很多个子 crate 。
首先在 <code>hello_world</code> 项目里面创建一个新的 crate :</p>
<pre><code class="language-console"># hello_world/ 目录中
$ cargo new hello_utils
</code></pre>
<p>这将创建新的 <code>hello_utils</code> 文件夹，其中已经设置好了 <code>Cargo.toml</code> 和 <code>src</code> 文件夹。
为了让Cargo知道新crate的存在，需要在 <code>hello_world/Cargo.toml</code> 中将 <code>hello_utils</code> 添加为依赖:</p>
<pre><code class="language-toml">[dependencies]
hello_utils = { path = &quot;hello_utils&quot; }
</code></pre>
<p>这会告诉Cargo依赖了一个名为 <code>hello_utils</code> 的crate，在 <code>hello_utils</code> 文件夹中(相对于 <code>Cargo.toml</code> 的位置)。</p>
<p>搞定！下次执行 <code>cargo build</code> 会自动构建 <code>hello_utils</code> 和它的所有依赖，其他包也可以使用这个crate。
但 <a href="https://crates.io/">crates.io</a> 发布的包不允许以路径指定某个依赖。
如果我们想发布 <code>hello_world</code>，就必须把 <code>hello_utils</code> 发布到 <a href="https://crates.io/">crates.io</a>，然后在 <code>hello_word</code> 配置中指定依赖版本:</p>
<pre><code class="language-toml">[dependencies]
hello_utils = { path = &quot;hello_utils&quot;, version = &quot;0.1.0&quot; }
</code></pre>
<blockquote>
<p><strong>注意</strong>: <a href="https://crates.io/">crates.io</a> 不允许发布带 <code>path</code> 依赖的包( <code>path</code> <a href="#development-dependencies">dev-dependencies</a> 除外)。对于备用选择，参考<a href="#multiple-locations">Multiple locations</a>。</p>
</blockquote>
<h3 id="多依赖位置"><a class="header" href="#多依赖位置">多依赖位置</a></h3>
<p>可以同时指定注册中心、 <code>git</code> 或 <code>path</code> 位置的依赖项。
<code>git</code> 或 <code>path</code> 依赖项用于本地( <code>version</code> 会与本地副本进行对比)，
而要发布到一个注册中心 (比如<a href="https://crates.io/">crates.io</a>) 时，需要使用注册中心中的版本，不允许其他组合。例如:</p>
<pre><code class="language-toml">[dependencies]
# 在本地时使用 `my-bitflags`
# 而上传后使用 crates.io 中的 1.0 版本
bitflags = { path = &quot;my-bitflags&quot;, version = &quot;1.0&quot; }

# 在本地时使用给定的 git 仓库
# 而上传后使用 crates.io 中的1.0 版本
smallvec = { git = &quot;https://github.com/servo/rust-smallvec.git&quot;, version = &quot;1.0&quot; }

# 如果 version 不能匹配，Cargo 会编译失败！
</code></pre>
<p>比如这种使用场景，当你把一个库拆分成工作空间中的多个包，
在开发阶段，可以用 <code>path</code> 指定工作空间内的本地包做为依赖，而将其发布后，就可以使用 <a href="https://crates.io/">crates.io</a> 上的版本了。</p>
<h3 id="平台特定依赖"><a class="header" href="#平台特定依赖">平台特定依赖</a></h3>
<p>平台特定依赖的书写格式没什么变化，但是要列在 <code>target</code> 部分。
通常使用与rust代码类似的 <a href="../../reference/conditional-compilation.html"><code>#[cfg]</code> 语法</a>:</p>
<pre><code class="language-toml">[target.'cfg(windows)'.dependencies]
winhttp = &quot;0.4.0&quot;

[target.'cfg(unix)'.dependencies]
openssl = &quot;1.0.1&quot;

[target.'cfg(target_arch = &quot;x86&quot;)'.dependencies]
native-i686 = { path = &quot;native/i686&quot; }

[target.'cfg(target_arch = &quot;x86_64&quot;)'.dependencies]
native-x86_64 = { path = &quot;native/x86_64&quot; }
</code></pre>
<p>如同rust代码一样，语法支持 <code>not</code>、<code>any</code> 和 <code>all</code> 操作符，从而组合不同的cfg键值对。</p>
<p>如果你想知道自己的平台支持哪些cfg目标，可以运行 <code>rustc --print=cfg</code> 来获取。
如果你想知道其他平台可用的cfg目标，可以使用 <code>rustc --print=cfg --target=x86_64-pc-windows-msvc</code>。</p>
<p>与rust代码不同，你不能使用 <code>[target.'cfg(feature = &quot;fancy-feature&quot;)'.dependencies]</code> 根据特性指定依赖，而应该使用 <a href="features.html">features</a>。</p>
<pre><code class="language-toml">[dependencies]
foo = { version = &quot;1.0&quot;, optional = true }
bar = { version = &quot;1.0&quot;, optional = true }

[features]
fancy-feature = [&quot;foo&quot;, &quot;bar&quot;]
</code></pre>
<p><code>cfg(debug_assertions)</code> ， <code>cfg(test)</code> 和 <code>cfg(proc_macro)</code> 也是同样的，这些值不生效。
总是有 <code>rustc --print=cfg</code> 返回的默认值。目前，无法根据这些设置添加依赖。</p>
<p>除 <code>#[cfg]</code> 标志，Cargo支持直接写出target全名来指定依赖:</p>
<pre><code class="language-toml">[target.x86_64-pc-windows-gnu.dependencies]
winhttp = &quot;0.4.0&quot;

[target.i686-unknown-linux-gnu.dependencies]
openssl = &quot;1.0.1&quot;
</code></pre>
<h4 id="为自定义目标指定依赖"><a class="header" href="#为自定义目标指定依赖">为自定义目标指定依赖</a></h4>
<p>如果使用自定义构建目标 (比如 <code>--target foo/bar.json</code> )，使用不含 <code>.json</code> 后缀的文件名:</p>
<pre><code class="language-toml">[target.bar.dependencies]
winhttp = &quot;0.4.0&quot;

[target.my-special-i686-platform.dependencies]
openssl = &quot;1.0.1&quot;
native = { path = &quot;native/i686&quot; }
</code></pre>
<blockquote>
<p><strong>注意</strong>: 在稳定版不支持自定义目标依赖。</p>
</blockquote>
<h3 id="开发依赖"><a class="header" href="#开发依赖">开发依赖</a></h3>
<p>你可以在 <code>Cargo.toml</code> 中添加 <code>[dev-dependencies]</code> ，格式与 <code>[dependencies]</code> 一致:</p>
<pre><code class="language-toml">[dev-dependencies]
tempdir = &quot;0.3&quot;
</code></pre>
<p>在构建包时不会使用开发依赖，而是用在编译测试、实例和性能测试。</p>
<p>这些依赖 <em>不会</em> 传播给依赖此包的那些包。</p>
<p>你也可以为特定目标指定开发依赖，只需要把 <code>dependencies</code> 换成 <code>dev-denpendencies</code> 。</p>
<pre><code class="language-toml">[target.'cfg(unix)'.dev-dependencies]
mio = &quot;0.0.1&quot;
</code></pre>
<blockquote>
<p><strong>注意</strong>: 当发布包时，只有那些以 <code>version</code> 指定的开发依赖才会包含在发布的包中。
大部分情况下，包发布后就不需要开发依赖了，但是也有一些使用者(比如操作系统包)希望在crate中运行一些测试，所以给开发依赖提供一个 <code>version</code> 也是有益处。</p>
</blockquote>
<h3 id="构建依赖"><a class="header" href="#构建依赖">构建依赖</a></h3>
<p>你可以在构建脚本中使用其他基于cargo的crate。在配置清单中指定 <code>build-dependencies</code> 来声明依赖。</p>
<pre><code class="language-toml">[build-dependencies]
cc = &quot;1.0.3&quot;
</code></pre>
<p>你也可以为特定目标指定构建依赖，只需将 <code>dependencies</code> 替换为 <code>build-dependencies</code> 。例如:</p>
<pre><code class="language-toml">[target.'cfg(unix)'.build-dependencies]
cc = &quot;1.0.3&quot;
</code></pre>
<p>这样，只有当主机平台满足指定目标要求时，才会构建相关依赖。</p>
<p>构建脚本无法使用 <code>dependencies</code> 和 <code>dev-dependencies</code> 中列出的依赖。
同样的，除非依赖放在 <code>dependencies</code> 中，包也无法使用构建依赖 (<code>build-dependencies</code>) 中的。
一个包和它的构建脚本是各自分开编译的，因此它们的依赖项不需要相同。
Cargo 不同目的使用各自的依赖，以保持简洁。</p>
<h3 id="选择特性"><a class="header" href="#选择特性">选择特性</a></h3>
<p>如果你依赖的包提供了可选的特性(feature)，可以选择使用:</p>
<pre><code class="language-toml">[dependencies.awesome]
version = &quot;1.3.5&quot;
default-features = false # 不使用默认特性
                         # 手动选择单独的特性
features = [&quot;secure-password&quot;, &quot;civet&quot;]
</code></pre>
<p>关于特性的更多信息，参考 <a href="features.html#dependency-features">features chapter</a>。</p>
<h3 id="在-cargotoml-中重命名依赖"><a class="header" href="#在-cargotoml-中重命名依赖">在 <code>Cargo.toml</code> 中重命名依赖</a></h3>
<p>当你在 <code>Cargo.toml</code> 中添加 <code>[dependencies]</code> 时，依赖名称就是导入代码的crate名称。
但在某些项目中，可能想要用另一个名称来引用这个crate，而不是它在crates.io上的名称。比如，你想:</p>
<ul>
<li>避免在代码中使用 <code>use foo as bar</code>。</li>
<li>同时使用某个crate的多个版本。</li>
<li>依赖不同注册中心同名的包。</li>
</ul>
<p>Cargo 通过在 <code>[dependencies]</code> 加入<code>package</code> 字段来支持此功能。</p>
<pre><code class="language-toml">[package]
name = &quot;mypackage&quot;
version = &quot;0.0.1&quot;

[dependencies]
foo = &quot;0.1&quot;
bar = { git = &quot;https://github.com/example/project.git&quot;, package = &quot;foo&quot; }
baz = { version = &quot;0.1&quot;, registry = &quot;custom&quot;, package = &quot;foo&quot; }
</code></pre>
<p>在这个例子中，这三个crate都在代码中可用:</p>
<pre><code class="language-rust ignore">extern crate foo; // crates.io
extern crate bar; // git repository
extern crate baz; // registry `custom`</code></pre>
<p>这三个crate在自身的 <code>Cargo.toml</code> 里都名为 <code>foo</code> ，用 <code>package</code> 来可以声明想要的那个 <code>foo</code> 包，在本地用另一个别名。
如果没有指定 <code>package</code> ，则认为包的名称与依赖名称一致。</p>
<p>注意，如果你有一个可选依赖:</p>
<pre><code class="language-toml">[dependencies]
bar = { version = &quot;0.1&quot;, package = 'foo', optional = true }
</code></pre>
<p>你依赖的是 crates.io 上的 <code>foo</code> 包，但是，需要指定的是 <code>bar</code> 的特性，而不是 <code>foo</code> 的特性。
即，如果你给一个依赖改了名，需要使用新的名称，而不是原本的名称。</p>
<p>依赖传递也是如此。比如，可以把下面的条目加入配置清单:</p>
<pre><code class="language-toml">[features]
log-debug = ['bar/log-debug'] # 用 'foo/log-debug' 会报错!
</code></pre>
<h3 id="从工作空间中继承依赖"><a class="header" href="#从工作空间中继承依赖">从工作空间中继承依赖</a></h3>
<p>可以在工作空间的 <a href="workspaces.html#the-dependencies-table"><code>[workspace.dependencies]</code></a> 字段指定依赖，
然后在 crate 的 <code>[dependencies]</code> 中添加 <code>workspace = true</code> 就可以继承这个依赖。</p>
<p>除了 <code>workspace</code> 字段，还可以加入:</p>
<ul>
<li><a href="features.html#optional-dependencies"><code>optional</code></a>: 注意 <code>[workspace.dependencies]</code> 不允许使用 <code>optional</code>。</li>
<li><a href="features.html"><code>features</code></a>: 这是对于 <code>[workspace.dependencies]</code> 中声明的依赖的补充。</li>
</ul>
<p>在 <code>optional</code> 和 <code>features</code> 之外，继承依赖不允许使用任何其他字段 (比如 <code>version</code> 或 <code>default-features</code>) 。</p>
<p><code>[dependencies]</code> 、 <code>[dev-dependencies]</code> 、 <code>[build-dependencies]</code> 、 <code>[target.&quot;...&quot;.dependencies]</code> 都可以引用 <code>[workspace.dependencies]</code> 中定义的依赖。</p>
<pre><code class="language-toml">[package]
name = &quot;bar&quot;
version = &quot;0.2.0&quot;

[dependencies]
regex = { workspace = true, features = [&quot;unicode&quot;] }

[build-dependencies]
cc.workspace = true

[dev-dependencies]
rand = { workspace = true, optional = true }
</code></pre>
<script>
(function() {
    var fragments = {
        "#overriding-dependencies": "overriding-dependencies.html",
        "#testing-a-bugfix": "overriding-dependencies.html#testing-a-bugfix",
        "#working-with-an-unpublished-minor-version": "overriding-dependencies.html#working-with-an-unpublished-minor-version",
        "#overriding-repository-url": "overriding-dependencies.html#overriding-repository-url",
        "#prepublishing-a-breaking-change": "overriding-dependencies.html#prepublishing-a-breaking-change",
        "#overriding-with-local-dependencies": "overriding-dependencies.html#paths-overrides",
    };
    var target = fragments[window.location.hash];
    if (target) {
        var url = window.location.toString();
        var base = url.substring(0, url.lastIndexOf('/'));
        window.location.replace(base + "/" + target);
    }
})();
</script>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../reference/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../reference/overriding-dependencies.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../reference/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../reference/overriding-dependencies.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
